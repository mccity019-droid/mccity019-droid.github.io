<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>متجر سيارات السيرفر</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  text-align: center;
  padding: 30px;
}

button {
  background: #5865F2;
  color: white;
  border: none;
  padding: 12px 20px;
  margin: 10px;
  font-size: 16px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #4752c4;
}

#cars {
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 30px;
}

.car {
  background: white;
  padding: 15px;
  border-radius: 10px;
  width: 200px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.car img {
  width: 100%;
  border-radius: 8px;
}

input {
  width: 100%;
  padding: 6px;
  margin-top: 6px;
}

#message {
  margin-top: 20px;
  font-weight: bold;
  color: green;
}
</style>
</head>

<body>

<h1>متجر سيارات السيرفر</h1>

<button id="login-btn">تسجيل دخول بالديسكورد</button>

<div id="user-area" style="display:none;">
  <p id="username"></p>

  <div id="cars">
    <div class="car">
      <img src="https://i.ibb.co/7vVbR1G/car1.jpg">
      <p>سيارة A</p>
      <input class="img-input" value="https://i.ibb.co/7vVbR1G/car1.jpg">
      <button class="order-btn" data-name="سيارة A">طلب السيارة</button>
    </div>

    <div class="car">
      <img src="https://i.ibb.co/3WbFG7g/car2.jpg">
      <p>سيارة B</p>
      <input class="img-input" value="https://i.ibb.co/3WbFG7g/car2.jpg">
      <button class="order-btn" data-name="سيارة B">طلب السيارة</button>
    </div>

    <div class="car">
      <img src="https://i.ibb.co/Yc5QZ7r/car3.jpg">
      <p>سيارة C</p>
      <input class="img-input" value="https://i.ibb.co/Yc5QZ7r/car3.jpg">
      <button class="order-btn" data-name="سيارة C">طلب السيارة</button>
    </div>
  </div>

  <div id="message"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

const CLIENT_ID = '1462902207329468562';
const REDIRECT_URI = 'https://mccity019-droid.github.io/';
const WEBHOOK = 'https://discord.com/api/webhooks/1462906362995675269/dpM3M1eBzKaA3839W-2wQJ1KAsN9GfGu-zuvzxKp32ZqyiLG2AAEHDdOqS6JEh7NzfHj';

let ordered = false;

// زر تسجيل الدخول
document.getElementById("login-btn").onclick = function () {
  location.href =
    "https://discord.com/api/oauth2/authorize" +
    "?client_id=" + CLIENT_ID +
    "&redirect_uri=" + encodeURIComponent(REDIRECT_URI) +
    "&response_type=token" +
    "&scope=identify";
};

// قراءة التوكن
if (location.hash) {
  const params = new URLSearchParams(location.hash.substring(1));
  const token = params.get("access_token");
  if (token) getUser(token);
}

function getUser(token) {
  fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: "Bearer " + token }
  })
  .then(r => r.json())
  .then(user => {
    document.getElementById("login-btn").style.display = "none";
    document.getElementById("user-area").style.display = "block";
    document.getElementById("username").innerText =
      "مرحباً " + user.username + "#" + user.discriminator;
  });
}

// أزرار الطلب
document.querySelectorAll(".order-btn").forEach(btn => {
  btn.onclick = function () {

    if (ordered) {
      document.getElementById("message").innerText =
        "تم إرسال طلبك مسبقًا، أكمل الإجراءات داخل الديسكورد.";
      return;
    }

    const car = btn.dataset.name;
    const img = btn.parentElement.querySelector(".img-input").value;

    fetch(WEBHOOK, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content:
          "طلب سيارة جديد\n" +
          "المستخدم: " + document.getElementById("username").innerText +
          "\nالسيارة: " + car,
        embeds: [{ title: car, image: { url: img } }]
      })
    }).then(() => {
      ordered = true;
      document.getElementById("message").innerText =
        "تم إرسال الطلب بنجاح، راجع الديسكورد.";
    });
  };
});

});
</script>

</body>
</html>
