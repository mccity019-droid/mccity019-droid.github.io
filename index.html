<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>متجر سيارات MC</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  button { padding: 10px 20px; margin: 10px; cursor: pointer; }
  #user-info { margin-top: 20px; }
  #car-preview img { width: 200px; margin-top: 10px; border-radius: 10px; }
  select { padding: 5px 10px; margin-top: 10px; }
</style>
</head>
<body>

<h1>متجر سيارات السيرفر</h1>

<button id="login-btn">تسجيل دخول بالديسكورد</button>

<div id="user-info" style="display:none;">
  <p id="username"></p>
  
  <select id="car-select">
    <option value="">اختر السيارة</option>
    <option value="سيارة A" data-img="https://i.ibb.co/7vVbR1G/car1.jpg">سيارة A</option>
    <option value="سيارة B" data-img="https://i.ibb.co/3WbFG7g/car2.jpg">سيارة B</option>
    <option value="سيارة C" data-img="https://i.ibb.co/Yc5QZ7r/car3.jpg">سيارة C</option>
    <option value="سيارة D" data-img="https://i.ibb.co/1Rx9s7H/car4.jpg">سيارة D</option>
    <option value="سيارة E" data-img="https://i.ibb.co/8X8c5T6/car5.jpg">سيارة E</option>
  </select>
  
  <div id="car-preview"></div>
  <button id="order-btn">طلب السيارة</button>
</div>

<script>
const CLIENT_ID = '1462902207329468562';
const REDIRECT_URI = 'https://mccity019-droid.github.io/#apply';
const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1462906362995675269/dpM3M1eBzKaA3839W-2wQJ1KAsN9GfGu-zuvzxKp32ZqyiLG2AAEHDdOqS6JEh7NzfHj';

// تسجيل دخول ديسكورد
document.getElementById('login-btn').onclick = () => {
    const url = https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify;
    window.location.href = url;
}

// التحقق من الـtoken بعد إعادة التوجيه
window.onload = () => {
    const hash = window.location.hash;
    if(hash) {
        const params = new URLSearchParams(hash.substring(1));
        const token = params.get('access_token');
        if(token) fetchDiscordUser(token);
    }
}

// جلب بيانات المستخدم
function fetchDiscordUser(token) {
    fetch('https://discord.com/api/users/@me', {
        headers: { Authorization: Bearer ${token} }
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('login-btn').style.display = 'none';
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('username').innerText = مرحباً، ${data.username}#${data.discriminator};
    });
}

// عرض صورة السيارة المختارة
document.getElementById('car-select').onchange = function() {
    const selected = this.options[this.selectedIndex];
    const imgUrl = selected.getAttribute('data-img');
    if(imgUrl){
        document.getElementById('car-preview').innerHTML = <p>${selected.value}</p><img src="${imgUrl}" alt="${selected.value}">;
    } else {
        document.getElementById('car-preview').innerHTML = '';
    }
}

// إرسال الطلب عبر Webhook
document.getElementById('order-btn').onclick = () => {
    const select = document.getElementById('car-select');
    const car = select.value;
    const imgUrl = select.options[select.selectedIndex].getAttribute('data-img');
    if(!car) return alert('اختر السيارة أولاً');
    
    fetch(DISCORD_WEBHOOK, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            content: تم طلب سيارة جديدة:\n- المستخدم: ${document.getElementById('username').innerText}\n- السيارة: ${car},
            embeds: [
                {
                    title: car,
                    image: { url: imgUrl }
                }
            ]
        })
    }).then(() => alert('تم إرسال الطلب بنجاح!'));
}
</script>

</body>
</html>
